<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<!-- three.js library -->
<script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
<script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
<script src="js/spriteSheet.js"></script>
<style>
    #arjsDebugUIContainer{
        display: none;
    }
    
    .a-enter-vr{
      display: none;  
    }

    #texture{

    }

    
    
    </style>
  <script>
    var velocityValue = 0.005;
AFRAME.registerComponent('test', {
  schema: {default: ''},
  init:function(){
    this.plane = document.querySelector(this.data);
    this.planeMessage = document.querySelector(this.data+"Message");
    this.direction = -1;
    this.currentTime = 0;
    this.currentValue = 1;
    this.textureWidth = this.plane.object3D.children[0].material.map.image.width;
    this.textureHeight = this.plane.object3D.children[0].material.map.image.height;
    //console.log(this.plane)
	
    this.plane.object3D.children[0].material.needsUpdate=true;
    
	if(this.planeMessage!=null){
		this.planeMessage.object3D.children[0].material.needsUpdate = true;
		this.messageMaterial = this.planeMessage.object3D.children[0].material;

		this.textureMessage = this.planeMessage.object3D.children[0].material.map;
		if(this.data == "#planeAns1Good"){
		  CreateSpriteSheets(this.textureMessage,[{anim:"loop",frames:[28,29,30,31,24,25,26,27,20,21,22,23,16,17,18,19,12,13,14,15,8,9,10,11,4,5,6,7,0,1,2],speed:0.08,onComplete:null,loop:false}],527,198,2108,1584);
		}
		else if(this.data == "#planeAns1Bad1"){
		  CreateSpriteSheets(this.textureMessage,[{anim:"loop",frames:[32,33,34,35,28,29,30,31,24,25,26,27,20,21,22,23,16,17,18,19,12,13,14,15,8,9,10,11,4,5,6,7,0],speed:0.08,onComplete:null,loop:false}],527,193,2108,1737);
		}
		else if(this.data == "#planeAns1Bad2"){
		  CreateSpriteSheets(this.textureMessage,[{anim:"loop",frames:[32,33,34,35,28,29,30,31,24,25,26,27,20,21,22,23,16,17,18,19,12,13,14,15,8,9,10,11,4,5,6,7,0],speed:0.08,onComplete:null,loop:false}],527,193,2108,1737);
		}
	}
  },
  tick:function(time,deltaTime){
    
    if(this.el.object3D.visible == true){
      //if()
      //this.plane.setAttribute("material","repeat",{x:0.5,y:0.5})
      this.plane.object3D.children[0].material.needsUpdate = true;
	  if(this.planeMessage!=null){
		this.messageMaterial.needsUpdate = true;
	  }
      this.plane.object3D.children[0].material.map.repeat.set(this.currentValue,this.currentValue);
      var offsetX = (((this.textureWidth/this.currentValue)-this.textureWidth)/2)/this.textureWidth;
      var offsetY = (((this.textureHeight/this.currentValue)-this.textureHeight)/2)/this.textureHeight;
      //console.log(offsetX,this.textureWidth)
      //console.log(this.plane.object3D.children[0].material.map)
      this.plane.object3D.children[0].material.map.offset.set(offsetX,offsetY);
      this.currentValue+=this.direction*velocityValue;
      if(this.currentValue<0.8){
        this.direction = 1;
      }
      else if(this.currentValue >1){
        this.direction = -1;
      }
      
      //console.log(deltaTime);
	  if(this.planeMessage!=null){
		  this.textureMessage.update(deltaTime/1000);
		  this.messageMaterial.needsUpdate = true;
		}
    }
    else{
      this.direction = -1;
      this.currentValue = 1;
	   if(this.planeMessage!=null){
		  if(this.textureMessage.idAnim != 0){
			setAnim(this.textureMessage,"loop");
		  }
	  }
    }

}
        
});
      
  		
      
  </script>
 
    
<body style="margin : 0px; overflow: hidden;">
   
    
  <a-scene embedded arjs="sourceType: webcam;">

    
    <a-assets>
        <img id="texture1God" src="assets/ans1/ans1_good.jpg">
    </a-assets>

    <a-assets>
        <img id="texture1Bad1" src="assets/ans1/ans1_wrong.jpg">
    </a-assets>

    <a-assets>
        <img id="texture1Bad2" src="assets/ans1/ans1_wrong.jpg">
    </a-assets>

    <a-assets>
        <img id="texture1GoodMessage" src="assets/ans1/CORRECT1_527f198_31f_30fps.png">
    </a-assets>

    <a-assets>
        <img id="texture1Bad1Message" src="assets/ans1/WRONG1_527x193_33f_30fps.png">
    </a-assets>

    <a-assets>
        <img id="texture1Bad2Message" src="assets/ans1/WRONG2_527x193_33f_30fps.png">
    </a-assets>

	<a-assets>
		<video id="video2Correct" autoplay loop="true" src="assets/ans2/2da_correcta.mp4"></video>
	</a-assets>

	<a-assets>
        <img id="texture2Bad" src="assets/ans2/2da_incorrecta.jpg">
    </a-assets>

	<a-assets>
		<img id="texture3God1" src="assets/ans3/3ra_correcta_1.jpg">	
	</a-assets>

	<a-assets>
		<img id="texture3God2" src="assets/ans3/3ra_correcta_2.jpg">	
	</a-assets>

	<a-assets>
        <video id="video3Bad" autoplay loop="true" src="assets/ans3/3ra_incorrecta.mp4"></video>
    </a-assets>

    <a-marker  type='pattern' preset='custom' url='data/data/pattern_1.patt' test="#planeAns1Good">

      <a-box position='0 0.5 0' material='opacity: 0.9;'></a-box>
      <a-plane id="planeAns1Good"src="#texture1God" height="1" width="1" position="0 1.05 0" rotation="-90 0 0">
      </a-plane>
      <a-plane id="planeAns1GoodMessage"src="#texture1GoodMessage" height="0.45" width="0.75" position="0 1.1 0.4" rotation="-90 0 0" material="transparent:true;">
      </a-plane>
    </a-marker>

    <a-marker  type='pattern' preset='custom' url='data/data/pattern_1B.patt' test="#planeAns1Bad1">

      <a-box position='0 0.5 0' material='opacity: 0.9;'></a-box>
      <a-plane id="planeAns1Bad1" src="#texture1Bad1" height="1" width="1" position="0 1.05 0" rotation="-90 0 0"></a-plane>
      <a-plane id="planeAns1Bad1Message"src="#texture1Bad1Message" height="0.45" width="0.75" position="0 1.1 0.4" rotation="-90 0 0" material="transparent:true;">
    </a-marker>

    <a-marker  type='pattern' preset='custom' url='data/data/pattern_1B2.patt' test="#planeAns1Bad2">

      <a-box position='0 0.5 0' material='opacity: 0.9;'></a-box>
      <a-plane id="planeAns1Bad2" src="#texture1Bad2" height="1" width="1" position="0 1.05 0" rotation="-90 0 0"></a-plane>
      <a-plane id="planeAns1Bad2Message"src="#texture1Bad2Message" height="0.45" width="0.75" position="0 1.1 0.4" rotation="-90 0 0" material="transparent:true;">
    </a-marker>

	<a-marker  type='pattern' preset='custom' url='data/data/pattern_2.patt' >

      <a-box position='0 0.5 0' material='opacity: 0.9;'></a-box>
      <a-video src="#video2Correct" width="1" height="1" position="0 1.05 0" rotation="-90 0 0"></a-video>
    </a-marker>

	<a-marker  type='pattern' preset='custom' url='data/data/pattern_2B.patt' test="#planeAns2Bad">

      <a-box position='0 0.5 0' material='opacity: 0.9;'></a-box>
      <a-plane id="planeAns2Bad" src="#texture2Bad" height="1" width="1" position="0 1.05 0" rotation="-90 0 0"></a-plane>
    </a-marker>

	<a-marker  type='pattern' preset='custom' url='data/data/pattern_3.patt' test="#planeAns3God">
      <a-box position='0 0.5 0' material='opacity: 0.9;'></a-box>
      <a-plane id="planeAns3God" src="#texture3God1" height="1" width="1" position="0 1.05 0" rotation="-90 0 0"></a-plane>
    </a-marker>

	<a-marker  type='pattern' preset='custom' url='data/data/pattern_3B.patt' >
		<a-box position='0 0.5 0' material='opacity: 0.9;'></a-box>
      <a-video src="#video3Bad" width="1" height="1" position="0 1.05 0" rotation="-90 0 0"></a-video>
    </a-marker>

      
<a-entity camera></a-entity>   
  </a-scene>
    
    
    
    
</body>

</html>
